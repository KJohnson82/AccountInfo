@* File: AccountInfo.Web/Components/Shared/AccountDetailPanel.razor *@
@* Read-only detail view for Internet or Phone accounts *@
@* Displays all account info, account managers, and repair contacts *@

@using AccountInfo.Shared.DTOs

<div class="detail-panel">
    @* ── Header with provider name + edit button ── *@
    <div class="detail-header">
        <div class="detail-header-info">
            <TelerikSvgIcon Icon="@(InternetAccount is not null ? SvgIcon.Globe : SvgIcon.Headset)"
                            Size="@ThemeConstants.SvgIcon.Size.Large" />
            <div>
                <h3 class="detail-title">@GetProviderName()</h3>
                <span class="detail-subtitle">
                    @(InternetAccount is not null ? "Internet Account" : "Phone Account")
                    @if (!string.IsNullOrEmpty(GetLocationName()))
                    {
                        <span> &mdash; @GetLocationName()</span>
                    }
                </span>
            </div>
        </div>
        <TelerikButton OnClick="@(() => OnEditClicked.InvokeAsync())"
                       Icon="@SvgIcon.Pencil"
                       ThemeColor="@ThemeConstants.Button.ThemeColor.Primary"
                       Class="edit-button">
            Edit
        </TelerikButton>
    </div>

    <div class="detail-body">
        @if (InternetAccount is not null)
        {
            @* ═══════════════════════════════════════════ *@
            @* INTERNET ACCOUNT DETAILS                    *@
            @* ═══════════════════════════════════════════ *@

            <div class="detail-section">
                <h4 class="section-title">
                    <TelerikSvgIcon Icon="@SvgIcon.InfoCircle" />
                    Account Information
                </h4>
                <div class="detail-grid">
                    <DetailField Label="Provider" Value="@InternetAccount.InternetProvider" />
                    <DetailField Label="Account Number" Value="@InternetAccount.DataAccountNumber" />
                    <DetailField Label="Circuit ID" Value="@InternetAccount.CircuitId" />
                    <DetailField Label="Service Type" Value="@InternetAccount.ServiceType" />
                    <DetailField Label="Connection Type" Value="@InternetAccount.ConnectionType" />
                    <DetailField Label="Connection Speed" Value="@InternetAccount.ConnectionSpeed" />
                    <DetailField Label="Monthly Cost" Value="@FormatCurrency(InternetAccount.MonthlyCost)" />
                    <DetailField Label="Account Added" Value="@FormatDate(InternetAccount.AccountAddedDate)" />
                    <DetailField Label="Bill Entry Date" Value="@FormatDate(InternetAccount.BillEntryDate)" />
                    <DetailField Label="Status" Value="@(InternetAccount.Active ? "Active" : "Inactive")" 
                                 BadgeClass="@(InternetAccount.Active ? "status-active" : "status-inactive")" />
                </div>
            </div>

            <div class="detail-section">
                <h4 class="section-title">
                    <TelerikSvgIcon Icon="@SvgIcon.Globe" />
                    Network Details
                </h4>
                <div class="detail-grid">
                    <DetailField Label="IP Address" Value="@InternetAccount.IPAddress" IsMono="true" />
                    <DetailField Label="Subnet Mask" Value="@InternetAccount.SubnetMask" IsMono="true" />
                    <DetailField Label="Default Gateway" Value="@InternetAccount.DefaultGateway" IsMono="true" />
                    <DetailField Label="DNS Primary" Value="@InternetAccount.DNSPrimary" IsMono="true" />
                    <DetailField Label="DNS Secondary" Value="@InternetAccount.DNSSecondary" IsMono="true" />
                </div>
            </div>

            @if (!string.IsNullOrEmpty(InternetAccount.AdminPortalURL) ||
                 !string.IsNullOrEmpty(InternetAccount.AdminUsername))
            {
                <div class="detail-section">
                    <h4 class="section-title">
                        <TelerikSvgIcon Icon="@SvgIcon.Lock" />
                        Admin Portal
                    </h4>
                    <div class="detail-grid">
                        <DetailField Label="Portal URL" Value="@InternetAccount.AdminPortalURL" IsLink="true" />
                        <DetailField Label="Username" Value="@InternetAccount.AdminUsername" />
                        <DetailField Label="Password" Value="@InternetAccount.AdminPassword" IsMasked="true" />
                        @if (!string.IsNullOrEmpty(InternetAccount.AdminInfo))
                        {
                            <DetailField Label="Admin Info" Value="@InternetAccount.AdminInfo" FullWidth="true" />
                        }
                        @if (!string.IsNullOrEmpty(InternetAccount.AdminAnswers))
                        {
                            <DetailField Label="Security Answers" Value="@InternetAccount.AdminAnswers" FullWidth="true" />
                        }
                    </div>
                </div>
            }

            @if (!string.IsNullOrEmpty(InternetAccount.Notes))
            {
                <div class="detail-section">
                    <h4 class="section-title">
                        <TelerikSvgIcon Icon="@SvgIcon.Comment" />
                        Notes
                    </h4>
                    <p class="detail-notes">@InternetAccount.Notes</p>
                </div>
            }

            @* Account Managers *@
            @RenderAccountManagers(InternetAccount.AccountManagers)

            @* Repair Contacts *@
            @RenderRepairContacts(InternetAccount.RepairContacts)
        }
        else if (PhoneAccount is not null)
        {
            @* ═══════════════════════════════════════════ *@
            @* PHONE ACCOUNT DETAILS                       *@
            @* ═══════════════════════════════════════════ *@

            <div class="detail-section">
                <h4 class="section-title">
                    <TelerikSvgIcon Icon="@SvgIcon.InfoCircle" />
                    Account Information
                </h4>
                <div class="detail-grid">
                    <DetailField Label="Local Provider" Value="@PhoneAccount.LocalProvider" />
                    <DetailField Label="Local Acct #" Value="@PhoneAccount.LocalAccountNumber" />
                    <DetailField Label="Long Distance Provider" Value="@PhoneAccount.LongDistanceProvider" />
                    <DetailField Label="Long Distance Acct #" Value="@PhoneAccount.LongDistanceAccountNumber" />
                    <DetailField Label="Monthly Cost" Value="@FormatCurrency(PhoneAccount.MonthlyCost)" />
                    <DetailField Label="Account Added" Value="@FormatDate(PhoneAccount.AccountAddedDate)" />
                    <DetailField Label="Bill Entry Date" Value="@FormatDate(PhoneAccount.BillEntryDate)" />
                    <DetailField Label="Status" Value="@(PhoneAccount.Active ? "Active" : "Inactive")"
                                 BadgeClass="@(PhoneAccount.Active ? "status-active" : "status-inactive")" />
                </div>
            </div>

            <div class="detail-section">
                <h4 class="section-title">
                    <TelerikSvgIcon Icon="@SvgIcon.Headset" />
                    Phone Numbers
                </h4>
                <div class="detail-grid">
                    <DetailField Label="Term Number" Value="@PhoneAccount.TermNumber" />
                    <DetailField Label="Fax Number" Value="@PhoneAccount.FaxNumber" />
                    <DetailField Label="Toll Free #1" Value="@PhoneAccount.TollFreeNumber1" />
                    <DetailField Label="Toll Free #2" Value="@PhoneAccount.TollFreeNumber2" />
                    @if (!string.IsNullOrEmpty(PhoneAccount.RolloverNumbers))
                    {
                        <DetailField Label="Rollover Numbers" Value="@PhoneAccount.RolloverNumbers" FullWidth="true" />
                    }
                </div>
            </div>

            @if (!string.IsNullOrEmpty(PhoneAccount.Notes))
            {
                <div class="detail-section">
                    <h4 class="section-title">
                        <TelerikSvgIcon Icon="@SvgIcon.Comment" />
                        Notes
                    </h4>
                    <p class="detail-notes">@PhoneAccount.Notes</p>
                </div>
            }

            @* Account Managers *@
            @RenderAccountManagers(PhoneAccount.AccountManagers)

            @* Repair Contacts *@
            @RenderRepairContacts(PhoneAccount.RepairContacts)
        }
    </div>
</div>

@code {
    [Parameter] public InternetAccountDto? InternetAccount { get; set; }
    [Parameter] public PhoneAccountDto? PhoneAccount { get; set; }
    [Parameter] public EventCallback OnEditClicked { get; set; }

    private string GetProviderName() =>
        InternetAccount?.InternetProvider ?? PhoneAccount?.LocalProvider ?? "Unknown";

    private string GetLocationName() =>
        InternetAccount?.LocationName ?? PhoneAccount?.LocationName ?? "";

    private string FormatCurrency(decimal? value) =>
        value.HasValue ? value.Value.ToString("C2") : "—";

    private string FormatDate(DateTime? value) =>
        value.HasValue ? value.Value.ToString("MM/dd/yyyy") : "—";

    // ── Shared render helpers ──

    private RenderFragment RenderAccountManagers(List<AccountManagerDto>? managers) => __builder =>
    {
        if (managers is not null && managers.Count > 0)
        {
            <div class="detail-section">
                <h4 class="section-title">
                    <TelerikSvgIcon Icon="@SvgIcon.User" />
                    Account Managers (@managers.Count)
                </h4>
                @foreach (var am in managers)
                {
                    <div class="contact-card" @key="am.Id">
                        <div class="detail-grid">
                            <DetailField Label="Company" Value="@am.AMCompany" />
                            <DetailField Label="Name" Value="@am.AMName" />
                            <DetailField Label="Email" Value="@am.AMEmail" IsLink="true" LinkPrefix="mailto:" />
                            <DetailField Label="Phone" Value="@am.AMPhone" IsLink="true" LinkPrefix="tel:" />
                        </div>
                    </div>
                }
            </div>
        }
    };

    private RenderFragment RenderRepairContacts(List<RepairContactDto>? contacts) => __builder =>
    {
        if (contacts is not null && contacts.Count > 0)
        {
            <div class="detail-section">
                <h4 class="section-title">
                    <TelerikSvgIcon Icon="@SvgIcon.Wrench" />
                    Repair Contacts (@contacts.Count)
                </h4>
                @foreach (var rc in contacts)
                {
                    <div class="contact-card" @key="rc.Id">
                        <div class="detail-grid">
                            <DetailField Label="Company" Value="@rc.RPCompany" />
                            <DetailField Label="Name" Value="@rc.RPName" />
                            <DetailField Label="Email" Value="@rc.RPEmail" IsLink="true" LinkPrefix="mailto:" />
                            <DetailField Label="Phone" Value="@rc.RPPhone" IsLink="true" LinkPrefix="tel:" />
                            @if (!string.IsNullOrEmpty(rc.RPPortal))
                            {
                                <DetailField Label="Portal" Value="@rc.RPPortal" IsLink="true" />
                            }
                        </div>
                    </div>
                }
            </div>
        }
    };
}
