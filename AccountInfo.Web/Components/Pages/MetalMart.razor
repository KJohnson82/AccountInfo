@page "/metalmart"

@using AccountInfo.Shared.DTOs
@using AccountInfo.Web.Components.Layout
@using AccountInfo.Web.Services

@inject ApiClient ApiClient

<AccountPageLayout PageTitle="Metal Mart Accounts"
                   Locations="@locations"
                   IsLoadingLocations="@isLoading" />

@code {
    private List<LocationDto>? locations;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var allLocations = await ApiClient.GetLocationsAsync();
            locations = allLocations?
                .Where(l => l.Loctype == 2) // 2 = MetalMart
                .ToList() ?? new();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading Metal Mart locations: {ex.Message}");
            locations = new();
        }
        finally
        {
            isLoading = false;
        }
    }
}